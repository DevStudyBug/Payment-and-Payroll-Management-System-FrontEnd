<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo">üí∞</div>
        <h1>PayFlow Bank Admin</h1>
      </div>
      <div class="user-section">
        <span class="user-info">
          <span class="user-icon">üë§</span>
          {{ userEmail }}
        </span>
        <button class="logout-btn" (click)="logout()">
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab == 'overview'"
        (click)="switchTab('overview')">
        üìä Overview
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab == 'organizations'"
        (click)="switchTab('organizations')">
        üè¢ Organizations
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab == 'payment'"
        (click)="switchTab('payment')">
        üí≥ Payment Requests
      </button>
    </div>

    <!-- OVERVIEW TAB -->
    <div *ngIf="activeTab == 'overview'" class="tab-content">
      <!-- Welcome Card -->
      <div class="welcome-card">
        <h2>Welcome to Bank Admin Dashboard! üéâ</h2>
        <p>Login successful! You are authenticated as <strong>BANK_ADMIN</strong></p>
        <div class="status-badge">
          <span class="badge success">‚úì Verified</span>
          <span class="badge info">User ID: {{ userId }}</span>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üè¢</div>
          <div class="stat-details">
            <h3>Pending Organizations</h3>
            <p class="stat-value">{{ pendingOrgCount }}</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìã</div>
          <div class="stat-details">
            <h3>Payment Requests</h3>
            <p class="stat-value">{{ totalPaymentRequests }}</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-details">
            <h3>Active Organizations</h3>
            <p class="stat-value">{{ activeOrgCount }}</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚è≥</div>
          <div class="stat-details">
            <h3>Pending Approvals</h3>
            <p class="stat-value">{{ pendingOrgCount + totalPaymentRequests }}</p>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="actions-section">
        <h3>Quick Actions</h3>
        <div class="action-buttons">
          <button class="action-btn primary" (click)="switchTab('organizations')">
            <span class="btn-icon">üè¢</span>
            View Organizations
          </button>
          <button class="action-btn secondary" (click)="switchTab('payment')">
            <span class="btn-icon">üí≥</span>
            View Payments
          </button>
          <button class="action-btn secondary">
            <span class="btn-icon">üìä</span>
            View Reports
          </button>
          <button class="action-btn secondary">
            <span class="btn-icon">‚öôÔ∏è</span>
            Settings
          </button>
        </div>
      </div>

      <!-- User Roles Info -->
      <div class="roles-card">
        <h3>Your Roles</h3>
        <div class="roles-list">
          <span class="role-badge" *ngFor="let role of userRoles">
            {{ role }}
          </span>
        </div>
      </div>
    </div>

    <!-- ORGANIZATIONS TAB -->
    <div *ngIf="activeTab == 'organizations'" class="tab-content">
      <div class="org-section">
        <!-- Pending Organizations -->
        <div class="section-card">
          <h2>‚è≥ Pending Organizations</h2>
          
          <div *ngIf="loading" class="loading-spinner">
            <p>Loading...</p>
          </div>

          <div *ngIf="!loading && pendingOrganizations.length == 0" class="empty-state">
            <p>No pending organizations</p>
          </div>

          <div *ngIf="!loading && pendingOrganizations.length > 0" class="org-list">
            <div *ngFor="let org of pendingOrganizations" class="org-card">
              <div class="org-header">
                <div class="org-info">
                  <h3>{{ org.orgName }}</h3>
                  <p class="org-email">{{ org.email }}</p>
                  <p class="org-reg">Org ID: {{ org.orgId }}</p>
                </div>
                <div [class]="'badge ' + getStatusClass(org.status)">
                  {{ org.status }}
                </div>
              </div>

              <div class="org-actions">
                <button 
                  class="btn btn-primary"
                  (click)="selectOrganization(org)">
                  View Details
                </button>
                <button 
                  class="btn btn-success"
                  (click)="verifyOrganization(org.orgId)"
                  [disabled]="loading">
                  ‚úì Verify
                </button>
                <button 
                  class="btn btn-danger"
                  (click)="openRejectModal('org', org.orgId)"
                  [disabled]="loading">
                  ‚úó Reject
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Selected Organization Details -->
        <div *ngIf="selectedOrganization" class="section-card">
          <h2>üìÑ Organization Details - {{ selectedOrganization.orgName }}</h2>

          <!-- Documents Section -->
          <div class="subsection">
            <h3>Documents</h3>
            <div *ngIf="selectedOrganization.documents && selectedOrganization.documents.length > 0" class="doc-list">
              <div *ngFor="let doc of selectedOrganization.documents; let i = index" class="doc-item">
                <div class="doc-header">
                  <div class="doc-info">
                    <p class="doc-name"><strong>{{ doc.fileName }}</strong></p>
                    <p class="doc-type">Type: {{ doc.fileType }}</p>
                    <p class="doc-date">Uploaded: {{ doc.uploadedAt | date: 'short' }}</p>
                  </div>
                  <div [class]="'badge ' + getStatusClass(doc.status)">
                    {{ doc.status }}
                  </div>
                </div>

                <div *ngIf="doc.status != 'APPROVED'" class="doc-actions">
                  <button 
                    class="btn btn-small btn-success"
                    (click)="verifyDocument(i)"
                    [disabled]="loading">
                    ‚úì Approve
                  </button>
                  <button 
                    class="btn btn-small btn-danger"
                    (click)="openRejectModal('document', selectedOrganization.orgId, i)"
                    [disabled]="loading">
                    ‚úó Reject
                  </button>
                </div>

                <a [href]="doc.fileUrl" target="_blank" class="doc-link">üìé View Document</a>
              </div>
            </div>
            <div *ngIf="!selectedOrganization.documents || selectedOrganization.documents.length == 0" class="empty-state">
              <p>No documents uploaded</p>
            </div>
          </div>

          <!-- Bank Details Section -->
          <div class="subsection">
            <h3>üè¶ Bank Details Verification</h3>
            <div class="bank-status">
              <p><strong>Status:</strong> 
                <span [class]="'badge ' + getStatusClass(selectedOrganization.bankVerificationStatus)">
                  {{ selectedOrganization.bankVerificationStatus }}
                </span>
              </p>
              <p *ngIf="selectedOrganization.bankRemarks"><strong>Remarks:</strong> {{ selectedOrganization.bankRemarks }}</p>
            </div>

            <div *ngIf="selectedOrganization.bankVerificationStatus != 'APPROVED'" class="bank-actions">
              <button 
                class="btn btn-success"
                (click)="verifyBankDetails()"
                [disabled]="loading">
                ‚úì Approve Bank Details
              </button>
              <button 
                class="btn btn-danger"
                (click)="openRejectModal('bank', selectedOrganization.orgId)"
                [disabled]="loading">
                ‚úó Reject Bank Details
              </button>
            </div>
          </div>

          <button 
            class="btn btn-secondary"
            (click)="selectedOrganization = null"
            style="margin-top: 20px;">
            ‚Üê Back
          </button>
        </div>
      </div>
    </div>

    <!-- PAYMENT REQUESTS TAB -->
    <div *ngIf="activeTab == 'payment'" class="tab-content">
      <div class="payment-section">
        <!-- Summary Cards -->
        <div *ngIf="paymentPageResponse" class="summary-cards">
          <div class="summary-card">
            <h4>Total Requests</h4>
            <p class="summary-value">{{ paymentPageResponse.summary.totalRequests }}</p>
          </div>
          <div class="summary-card">
            <h4>Pending</h4>
            <p class="summary-value warning">{{ paymentPageResponse.summary.totalPending }}</p>
          </div>
          <div class="summary-card">
            <h4>Approved</h4>
            <p class="summary-value success">{{ paymentPageResponse.summary.totalApproved }}</p>
          </div>
          <div class="summary-card">
            <h4>Rejected</h4>
            <p class="summary-value danger">{{ paymentPageResponse.summary.totalRejected }}</p>
          </div>
          <div class="summary-card">
            <h4>Total Amount</h4>
            <p class="summary-value">‚Çπ{{ paymentPageResponse.summary.totalAmount | number: '1.2-2' }}</p>
          </div>
        </div>

        <!-- Filters Section -->
        <div class="section-card">
          <h3>üîç Filters</h3>
          <div class="filter-row">
            <div class="filter-group">
              <label>Status</label>
              <select [(ngModel)]="paymentFilters.status" class="form-control">
                <option value="">All</option>
                <option value="PENDING">Pending</option>
                <option value="APPROVED">Approved</option>
                <option value="REJECTED">Rejected</option>
                <option value="PAID">Paid</option>
              </select>
            </div>

            <div class="filter-group">
              <label>Type</label>
              <select [(ngModel)]="paymentFilters.type" class="form-control">
                <option value="">All</option>
                <option value="SALARY">Salary</option>
                <option value="ADVANCE">Advance</option>
                <option value="REFUND">Refund</option>
              </select>
            </div>

            <div class="filter-group">
              <label>Page Size</label>
              <select [(ngModel)]="paymentFilters.size" class="form-control">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
              </select>
            </div>

            <button 
              class="btn btn-primary filter-btn"
              (click)="filterPaymentRequests()"
              [disabled]="loading">
              Apply Filters
            </button>
          </div>
        </div>

        <!-- Payment Requests List -->
        <div class="section-card">
          <h2>üí≥ Payment Requests</h2>

          <div *ngIf="loading" class="loading-spinner">
            <p>Loading...</p>
          </div>

          <div *ngIf="!loading && paymentRequests.length == 0" class="empty-state">
            <p>No payment requests found</p>
          </div>

          <div *ngIf="!loading && paymentRequests.length > 0" class="payment-table">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Organization</th>
                  <th>Type</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Request Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let payment of paymentRequests" 
                    [class.selected]="selectedPaymentRequest?.paymentId == payment.paymentId">
                  <td>#{{ payment.paymentId }}</td>
                  <td>{{ payment.organizationName }}</td>
                  <td>{{ payment.requestType }}</td>
                  <td>‚Çπ{{ payment.amount | number: '1.2-2' }}</td>
                  <td>
                    <span [class]="'badge ' + getStatusClass(payment.status)">
                      {{ payment.status }}
                    </span>
                  </td>
                  <td>{{ payment.requestDate | date: 'short' }}</td>
                  <td>
                    <button 
                      class="btn btn-small btn-info"
                      (click)="selectPaymentRequest(payment.paymentId)">
                      View
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div *ngIf="paymentPageResponse && !loading" class="pagination">
            <button 
              class="btn btn-small"
              (click)="previousPage()"
              [disabled]="currentPage == 0">
              ‚Üê Previous
            </button>
            <span class="page-info">
              Page {{ currentPage + 1 }} of {{ totalPages }}
            </span>
            <button 
              class="btn btn-small"
              (click)="nextPage()"
              [disabled]="currentPage >= totalPages - 1">
              Next ‚Üí
            </button>
          </div>
        </div>

        <!-- Payment Request Details -->
        <div *ngIf="selectedPaymentRequest" class="section-card">
          <h2>üìã Payment Request Details</h2>

          <div class="detail-section">
            <div class="detail-row">
              <div class="detail-item">
                <label>Payment ID:</label>
                <p>#{{ selectedPaymentRequest.paymentId }}</p>
              </div>
              <div class="detail-item">
                <label>Organization:</label>
                <p>{{ selectedPaymentRequest.orgName }}</p>
              </div>
              <div class="detail-item">
                <label>Type:</label>
                <p>{{ selectedPaymentRequest.requestType }}</p>
              </div>
              <div class="detail-item">
                <label>Amount:</label>
                <p>‚Çπ{{ selectedPaymentRequest.amount | number: '1.2-2' }}</p>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-item">
                <label>Status:</label>
                <p>
                  <span [class]="'badge ' + getStatusClass(selectedPaymentRequest.status)">
                    {{ selectedPaymentRequest.status }}
                  </span>
                </p>
              </div>
              <div class="detail-item">
                <label>Request Date:</label>
                <p>{{ selectedPaymentRequest.requestDate | date: 'short' }}</p>
              </div>
              <div class="detail-item">
                <label>Approval Date:</label>
                <p>{{ selectedPaymentRequest.approvalDate | date: 'short' }}</p>
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-item full-width">
                <label>Description:</label>
                <p>{{ selectedPaymentRequest.description }}</p>
              </div>
            </div>

            <div *ngIf="selectedPaymentRequest.remark" class="detail-row">
              <div class="detail-item full-width">
                <label>Remark:</label>
                <p>{{ selectedPaymentRequest.remark }}</p>
              </div>
            </div>
          </div>

          <!-- Disbursements Table -->
          <div class="subsection" *ngIf="selectedPaymentRequest.disbursements && selectedPaymentRequest.disbursements.length > 0">
            <h3>üí∞ Salary Disbursements</h3>
            <table class="disbursement-table">
              <thead>
                <tr>
                  <th>Employee Name</th>
                  <th>Employee ID</th>
                  <th>Net Salary</th>
                  <th>Status</th>
                  <th>Bank Status</th>
                  <th>Remark</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let disbursement of selectedPaymentRequest.disbursements">
                  <td>{{ disbursement.employeeName }}</td>
                  <td>#{{ disbursement.employeeId }}</td>
                  <td>‚Çπ{{ disbursement.netSalary | number: '1.2-2' }}</td>
                  <td>
                    <span [class]="'badge ' + getStatusClass(disbursement.status)">
                      {{ disbursement.status }}
                    </span>
                  </td>
                  <td>
                    <span [class]="'badge ' + getStatusClass(disbursement.bankStatus)">
                      {{ disbursement.bankStatus }}
                    </span>
                  </td>
                  <td>{{ disbursement.remark || '-' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button 
              *ngIf="selectedPaymentRequest.status == 'PENDING'"
              class="btn btn-success"
              (click)="approvePayment(selectedPaymentRequest.paymentId)"
              [disabled]="loading">
              ‚úì Approve Payment
            </button>
            <button 
              *ngIf="selectedPaymentRequest.status == 'PENDING'"
              class="btn btn-danger"
              (click)="openRejectModal('payment', selectedPaymentRequest.paymentId)"
              [disabled]="loading">
              ‚úó Reject Payment
            </button>
            <button 
              *ngIf="selectedPaymentRequest.status == 'APPROVED'"
              class="btn btn-primary"
              (click)="disbursePayment(selectedPaymentRequest.paymentId)"
              [disabled]="loading">
              üí≥ Disburse Payment
            </button>
            <button 
              class="btn btn-secondary"
              (click)="selectedPaymentRequest = null">
              ‚Üê Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Reject Modal -->
  <div *ngIf="showRejectModal" class="modal-overlay" (click)="closeRejectModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>‚ùå Reject {{ rejectType == 'org' ? 'Organization' : rejectType == 'document' ? 'Document' : rejectType == 'bank' ? 'Bank Details' : 'Payment Request' }}</h2>
      
      <div class="form-group">
        <label>Rejection Reason</label>
        <textarea 
          [(ngModel)]="rejectReason"
          placeholder="Enter reason for rejection..."
          rows="5"
          class="form-control"></textarea>
      </div>

      <div class="modal-actions">
        <button 
          class="btn btn-primary"
          (click)="submitReject()"
          [disabled]="loading || !rejectReason.trim()">
          Submit Rejection
        </button>
        <button 
          class="btn btn-secondary"
          (click)="closeRejectModal()"
          [disabled]="loading">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>